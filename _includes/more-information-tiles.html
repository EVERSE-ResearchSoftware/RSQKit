{%- if page.fairsharing %}
{%- assign actual_fairsharing = nil %}
{%- for standard in page.fairsharing %}
{%- if standard.name %}
{%- assign actual_fairsharing = 1 %}
{%- endif %}
{%- endfor %}
{%- endif %}
{%- if page.faircookbook %}
{%- assign actual_faircookbook = nil %}
{%- for recipe in page.faircookbook %}
{%- if recipe.name %}
{%- assign actual_faircookbook = 1 %}
{%- endif %}
{%- endfor %}
{%- endif %}
{%- if page.dsw %}
{%- assign actual_dsw = nil %}
{%- for question in page.dsw %}
{%- if question.name %}
{%- assign actual_dsw = 1 %}
{%- endif %}
{%- endfor %}
{%- endif %}
{%- if page.rdmkit %}
{%- assign actual_rdmkit = nil %}
{%- for rdmdoc in page.rdmkit %}
{%- if rdmdoc.name %}
{%- assign actual_rdmkit = 1 %}
{%- endif %}
{%- endfor %}
{%- endif %}
{%- if (page.training_type == "link" or page.training_type == "preview") and page.training %}
{%- assign actual_training = nil %}
{%- for training in page.training %}
{%- if training.name %}
{%- assign actual_training = 1 %}
{%- endif %}
{%- endfor %}
{%- endif %}
{%- if page.page_id and site.theme_variables.headings.resource-table-all-collapse%}
{%- assign tools = site.data.tool_and_resource_list | where:"related_pages", page.page_id %}
{%- unless tools.size == 0 %}
{%- assign actual_tools = 1 %}
{%- endunless %}
{%- assign country_pages = site.pages | where_exp: "item", "item.search_exclude != true" | where_exp:"item","item.national_resources != nil" %}
{%- unless country_pages.size == 0 %}
{%- assign tool_matches_total = 0 %}
{%- assign query = "related_pages." | append: page.type %}
{%- for country_page in country_pages %}
{%- assign tool_matches = country_page.national_resources | where_exp:"resource","resource.related_pages != nil" | where: query, page.page_id %}
{%- assign tool_matches_total = tool_matches_total | plus: tool_matches.size %}
{%- endfor %}
{%- endunless %}
{%- unless tool_matches_total == 0 %}
{%- assign actual_nat_tools = 1 %}
{%- endunless %}
{%- endif %}
{%- if actual_fairsharing or actual_faircookbook or actual_dsw or actual_rdmkit or actual_dsw or actual_training or actual_tools or actual_nat_tools %}
<h2 class="mb-4">{{site.theme_variables.headings.more-information-tiles | default: 'More information' }}</h2>
{%- endif %}

{%- if actual_training %}
<!-- Training -->
<a data-bs-toggle="collapse" href="#training_collapse" role="button" aria-expanded="false" aria-controls="training_collapse" class="d-flex align-items-baseline pb-3 border-top info-collapse">
    <h3 class="mb-0 flex-grow-1 mt-3 text-dark">Training</h3><i class="fa-solid fa-chevron-down fs-5"></i>
</a>
<div class="collapse info-card" id="training_collapse">
    <div class="mt-2 p-3 pb-5">

        {%- if page.training_type == "link" %}
        <div class="row row-cols-1 row-cols-md-2 gy-2 gx-4 info-links">
            {%- for training in page.training %}
            <div class="col">
                <a class="btn d-grid h-100" href="{{ training.url }}/materials?q={{ training.query | split: ' ' | join: '+' }}">
                    <div class="row g-1">
                        <div class="col-2 d-flex align-items-center justify-content-center">
                            {%- assign registry = training.registry | downcase %}
                            {%- if registry == "tess" or page.training_type == "link" %}
                            <img alt="TeSS logo" class="img-fluid" src="{{ 'assets/img/tess_logo.svg' | relative_url }}">
                            {%- elsif registry == "zenodo" %}
                            <img alt="Zenodo logo" class="img-fluid" src="{{ 'assets/img/zenodo_logo.svg' | relative_url }}">
                            {%- elsif registry == "youtube" %}
                            <img alt="YouTube logo" class="img-fluid" src="{{ 'assets/img/youtube_logo.svg' | relative_url }}">
                            {%- elsif registry == "carpentries" %}
                            <img alt="Carpentries" class="img-fluid" src="{{ 'assets/img/carpentries_logo.svg' | relative_url }}">
                            {%- elsif registry == "github" %}
                            <i class="fa-brands fa-github text-dark fa-2xl my-3"></i>
                            {%- else %}
                            <i class="fa-solid fa-external-link-alt text-primary fa-lg my-3"></i>
                            {%- endif %}
                        </div>
                        <div class="col-10 d-flex align-items-center">
                            <span class="text-start">Training in {{ training.name }}</span>
                        </div>
                    </div>
                </a>
            </div>

            {%- endfor %}
        </div>
        {%- endif %}

        {%- if page.training_type == "preview" %}
        {%- for training in page.training %}
        <link rel="stylesheet" property="stylesheet" href="https://elixirtess.github.io/TeSS_widgets/css/tess-widget.css"/>
        <div id="tess-widget-materials-table" class="tess-widget tess-widget-faceted-table"></div>
        <script>
        function initTeSSWidgets() {
            TessWidget.Materials(document.getElementById('tess-widget-materials-table'),
                'FacetedTable',
                {
                    opts: {
                        columns: [{name: 'Name', field: 'title'},
                            {name: 'Description', field: 'description'}],
                        allowedFacets: ['scientific-topics', 'target-audience'],
                        facetOptionLimit: 5
                    },
                    params: {
                        pageSize: '{{ page.training_n_display }}',
                        q: '{{ training.query }}'
                    },
                    baseUrl: '{{ training.url }}',
                    instanceName: '{{ training.name }}'
                });
        }
        </script>
        <script async="" defer="" src="https://elixirtess.github.io/TeSS_widgets/js/tess-widget-standalone.js" onload="initTeSSWidgets()"></script>
        {%- endfor %}
        {%- endif %}

    </div>
</div>
{%- endif %}